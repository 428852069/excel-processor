<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿è¡¨æ ¼è‡ªåŠ¨åŒ–å¤„ç†ä¸­å¿ƒ</title>
    <!-- 1. å¼•å…¥ Handsontable çš„æ ·å¼æ–‡ä»¶ -->
    <link href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css" rel="stylesheet">
    <style>
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        body { margin: 20px; background-color: #f5f7fa; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); padding: 25px; }
        header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        header h1 { color: #2c3e50; margin-bottom: 5px; }
        header p { color: #7f8c8d; font-size: 1.1em; }

        /* åŠŸèƒ½åŒºæ ·å¼ */
        .control-panel { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 6px; align-items: center; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; transition: all 0.2s; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn-secondary:hover { background-color: #545b62; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-success:hover { background-color: #1e7e34; }
        .btn-warning { background-color: #ffc107; color: #212529; }
        .btn-warning:hover { background-color: #d39e00; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-danger:hover { background-color: #bd2130; }
        .file-input-wrapper { flex-grow: 1; }
        .file-input-wrapper input[type="file"] { padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100%; }

        /* å·¥å…·æ æ ·å¼ */
        .toolbar { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; padding: 15px; background: #e9ecef; border-radius: 6px; }
        .toolbar-label { font-weight: bold; color: #495057; margin-right: 10px; align-self: center; }

        /* è¡¨æ ¼ç¼–è¾‘åŒºæ ·å¼ */
        #excelEditorContainer { height: 600px; margin-bottom: 20px; border: 1px solid #dee2e6; border-radius: 6px; overflow: hidden; }

        /* æäº¤ä¸ä¸‹è½½åŒº */
        .submit-area { text-align: center; padding-top: 20px; border-top: 1px solid #eee; }
        .instructions { background-color: #e7f3ff; padding: 15px; border-radius: 6px; margin-top: 20px; border-left: 4px solid #007bff; }
        .instructions p { margin: 5px 0; font-size: 0.95em; }
        
        /* çŠ¶æ€æç¤º */
        .status { padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.9em; }
        .status-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status-info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        /* è°ƒè¯•ä¿¡æ¯ */
        .debug-info { background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.85em; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š åœ¨çº¿è¡¨æ ¼è‡ªåŠ¨åŒ–å¤„ç†ä¸­å¿ƒ</h1>
            <p>ä¸Šä¼ Excelæ–‡ä»¶ï¼Œä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å¤„ç†ï¼Œç¼–è¾‘åä¸€é”®æäº¤</p>
        </header>

        <!-- çŠ¶æ€æç¤ºåŒºåŸŸ -->
        <div id="statusArea"></div>

        <!-- 1. ä¸Šä¼ æ–‡ä»¶åŒº -->
        <div class="control-panel">
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" accept=".xlsx, .xls, .csv">
            </div>
            <button onclick="document.getElementById('fileInput').click()" class="btn btn-primary">ğŸ“ é€‰æ‹©Excelæ–‡ä»¶</button>
            <button onclick="saveFile()" class="btn btn-success">ğŸ’¾ ä¸‹è½½å½“å‰è¡¨æ ¼</button>
            <button onclick="clearData()" class="btn btn-danger">ğŸ—‘ï¸ æ¸…ç©ºè¡¨æ ¼</button>
        </div>

        <!-- 2. å·¥å…·æ ï¼ˆå››ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬æŒ‰é’®ï¼‰ -->
        <div class="toolbar">
            <div class="toolbar-label">ğŸ”§ è‡ªåŠ¨åŒ–å·¥å…·ï¼š</div>
            <button onclick="checkAge()" class="btn btn-warning">æ£€éªŒæ˜¯å¦æ»¡14å‘¨å²</button>
            <button onclick="markLeague()" class="btn btn-warning">è‡ªåŠ¨æ ‡è®°æ˜¯å¦å…¥å›¢</button>
            <button onclick="markGraduation()" class="btn btn-warning">è‡ªåŠ¨æ ‡è®°æ˜¯å¦æ¯•ä¸š</button>
            <button onclick="checkActivity()" class="btn btn-warning">æ£€éªŒå…‰å±±å¿è·¨æ ¡ç§¯æåˆ†å­</button>
        </div>

        <!-- 3. è¡¨æ ¼ç¼–è¾‘åŒºï¼ˆæ ¸å¿ƒåŒºåŸŸï¼‰ -->
        <h3>åœ¨çº¿ç¼–è¾‘åŒº</h3>
        <div id="excelEditorContainer"></div>

        <!-- è°ƒè¯•ä¿¡æ¯åŒºåŸŸ -->
        <div id="debugArea" class="debug-info"></div>

        <!-- 4. æäº¤ä¸ä¸‹è½½åŒº -->
        <div class="submit-area">
            <button onclick="submitToCollectForm()" class="btn btn-success" style="padding: 12px 30px; font-size: 1.1em;">
                âœ… å¤„ç†å®Œæˆï¼Œç‚¹å‡»æäº¤
            </button>
            <p style="color:#6c757d; margin-top: 8px;">ç‚¹å‡»åï¼Œå°†è‡ªåŠ¨è·³è½¬åˆ°æ–‡ä»¶æ”¶é›†é¡µé¢</p>
        </div>

        <!-- 5. ä½¿ç”¨è¯´æ˜ -->
        <div class="instructions">
            <p><strong>ä½¿ç”¨æµç¨‹ï¼š</strong></p>
            <p>1. ç‚¹å‡»"é€‰æ‹©Excelæ–‡ä»¶"æŒ‰é’®ä¸Šä¼ æ–‡ä»¶ â†’ 2. è¡¨æ ¼è‡ªåŠ¨åŠ è½½ â†’ 3. ç›´æ¥åŒå‡»å•å…ƒæ ¼ç¼–è¾‘ â†’ 4. ä½¿ç”¨ä¸Šæ–¹å·¥å…·æŒ‰é’®è¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç† â†’ 5. ç‚¹å‡»"ä¸‹è½½å½“å‰è¡¨æ ¼"å¤‡ä»½ â†’ 6. ç‚¹å‡»"æäº¤"æŒ‰é’®è·³è½¬åˆ°æ”¶é›†è¡¨ä¸Šä¼ </p>
            <p><strong>æ³¨æ„ï¼š</strong>æ‰€æœ‰æ“ä½œéƒ½åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­å®Œæˆï¼Œæ•°æ®å®‰å…¨æœ‰ä¿éšœã€‚</p>
        </div>
    </div>

    <!-- 2. å¼•å…¥ SheetJS åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- 3. å¼•å…¥ Handsontable åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>

    <script>
        // --- å…¨å±€å˜é‡ ---
        let hot; // Handsontable å®ä¾‹
        let currentData = []; // å½“å‰è¡¨æ ¼æ•°æ®
        let currentFileName = '';
        let columnHeaders = []; // å­˜å‚¨åˆ—æ ‡é¢˜

        // --- çŠ¶æ€æç¤ºå‡½æ•° ---
        function showStatus(message, type = 'info') {
            const statusArea = document.getElementById('statusArea');
            statusArea.innerHTML = `<div class="status status-${type}">${message}</div>`;
            setTimeout(() => {
                if (statusArea.firstChild) {
                    statusArea.firstChild.style.opacity = '0';
                    setTimeout(() => statusArea.innerHTML = '', 500);
                }
            }, 3000);
        }

        // --- è°ƒè¯•ä¿¡æ¯å‡½æ•° ---
        function showDebugInfo(info) {
            const debugArea = document.getElementById('debugArea');
            debugArea.innerHTML = `<strong>è°ƒè¯•ä¿¡æ¯ï¼š</strong> ${info}`;
        }

        // --- Handsontable åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('excelEditorContainer');
            
            // ä¿®å¤é…ç½®ï¼šç¡®ä¿æ­£ç¡®åˆå§‹åŒ–
            hot = new Handsontable(container, {
                data: [],
                rowHeaders: true,
                colHeaders: true,
                height: '100%',
                width: '100%',
                licenseKey: 'non-commercial-and-evaluation',
                manualRowResize: true,
                manualColumnResize: true,
                contextMenu: true,
                columnSorting: true,
                stretchH: 'all', // å…³é”®ï¼šè®©åˆ—è‡ªåŠ¨æ‹‰ä¼¸å¡«å……
                wordWrap: false,
                // ä¿®å¤åˆ—æ˜¾ç¤ºé—®é¢˜
                columns: null, // ä¸é¢„å®šä¹‰åˆ—ï¼Œè®©Handsontableè‡ªåŠ¨æ£€æµ‹
                colWidths: null, // ä¸é¢„å®šä¹‰å®½åº¦
                // æ•°æ®å˜åŒ–ç›‘å¬
                afterChange: function(changes, source) {
                    if (source === 'loadData') return;
                    currentData = hot.getSourceData();
                },
                // æ¸²æŸ“åè°ƒæ•´
                afterRender: function() {
                    autoFitColumns();
                }
            });

            // æ–‡ä»¶é€‰æ‹©ç›‘å¬
            document.getElementById('fileInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    loadFile();
                }
            });

            showStatus('è¡¨æ ¼ç¼–è¾‘å™¨å·²å‡†å¤‡å°±ç»ªï¼Œè¯·é€‰æ‹©Excelæ–‡ä»¶å¼€å§‹ä½¿ç”¨ã€‚', 'info');
            showDebugInfo('ç­‰å¾…åŠ è½½æ–‡ä»¶...');
        });

        // --- è¾…åŠ©å‡½æ•°ï¼šè‡ªåŠ¨è°ƒæ•´åˆ—å®½ ---
        function autoFitColumns() {
            setTimeout(() => {
                try {
                    const cols = hot.countCols();
                    const rows = hot.countRows();
                    
                    showDebugInfo(`è¡¨æ ¼å°ºå¯¸ï¼š${rows} è¡Œ Ã— ${cols} åˆ—`);
                    
                    if (cols > 0) {
                        // æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´åˆ—å®½
                        for (let col = 0; col < cols; col++) {
                            let maxLength = 100; // æœ€å°å®½åº¦
                            
                            // æ£€æŸ¥è¡¨å¤´é•¿åº¦
                            if (columnHeaders[col]) {
                                maxLength = Math.max(maxLength, columnHeaders[col].toString().length * 10);
                            }
                            
                            // æ£€æŸ¥å‰å‡ è¡Œæ•°æ®é•¿åº¦
                            for (let row = 0; row < Math.min(rows, 10); row++) {
                                const cellValue = hot.getDataAtCell(row, col);
                                if (cellValue) {
                                    maxLength = Math.max(maxLength, cellValue.toString().length * 8);
                                }
                            }
                            
                            // é™åˆ¶æœ€å¤§å®½åº¦
                            hot.setCellMeta(0, col, 'colWidths', Math.min(maxLength, 300));
                        }
                        hot.render();
                    }
                } catch (error) {
                    console.error('è°ƒæ•´åˆ—å®½æ—¶å‡ºé”™:', error);
                }
            }, 200);
        }

        // --- æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---

        // 1. åŠ è½½Excelæ–‡ä»¶åˆ°è¡¨æ ¼ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼‰
        function loadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                showStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªExcelæ–‡ä»¶', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    showStatus('æ­£åœ¨è§£ææ–‡ä»¶ï¼Œè¯·ç¨å€™...', 'info');
                    showDebugInfo('å¼€å§‹è§£ææ–‡ä»¶...');
                    
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { 
                        type: 'array',
                        cellDates: true, // æ­£ç¡®å¤„ç†æ—¥æœŸ
                        cellStyles: true, // ä¿ç•™æ ·å¼ä¿¡æ¯
                        raw: false // è·å–æ ¼å¼åŒ–åçš„å€¼
                    });
                    
                    showDebugInfo(`å·¥ä½œç°¿åŒ…å« ${workbook.SheetNames.length} ä¸ªå·¥ä½œè¡¨`);
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // è·å–å·¥ä½œè¡¨èŒƒå›´
                    const range = XLSX.utils.decode_range(worksheet['!ref']);
                    const totalRows = range.e.r + 1;
                    const totalCols = range.e.c + 1;
                    
                    showDebugInfo(`å·¥ä½œè¡¨èŒƒå›´ï¼š${totalRows} è¡Œ Ã— ${totalCols} åˆ— (A1:${XLSX.utils.encode_cell(range.e)})`);
                    
                    // ä¿®å¤å…³é”®ï¼šä½¿ç”¨ sheet_to_json çš„æ­£ç¡®å‚æ•°
                    // æ–¹æ³•1ï¼šè½¬æ¢ä¸ºäºŒç»´æ•°ç»„ï¼ˆæ¨èï¼‰
                    let jsonData = [];
                    if (worksheet['!ref']) {
                        // ç›´æ¥è·å–åŸå§‹å•å…ƒæ ¼æ•°æ®
                        for (let R = range.s.r; R <= range.e.r; ++R) {
                            const row = [];
                            for (let C = range.s.c; C <= range.e.c; ++C) {
                                const cell_address = {c: C, r: R};
                                const cell_ref = XLSX.utils.encode_cell(cell_address);
                                const cell = worksheet[cell_ref];
                                row.push(cell ? cell.v : '');
                            }
                            jsonData.push(row);
                        }
                    }
                    
                    // å¦‚æœæ–¹æ³•1å¤±è´¥ï¼Œä½¿ç”¨æ–¹æ³•2
                    if (jsonData.length === 0 || jsonData[0].length === 0) {
                        showDebugInfo('ä½¿ç”¨æ–¹æ³•2è§£ææ•°æ®...');
                        jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                            header: 1,
                            defval: '', // é»˜è®¤å€¼
                            blankrows: true // ä¿ç•™ç©ºè¡Œ
                        });
                    }
                    
                    console.log('è§£æåçš„æ•°æ®:', jsonData);
                    
                    if (jsonData.length === 0) {
                        showStatus('æ–‡ä»¶ä¸ºç©ºæˆ–æ— æ³•è¯»å–', 'error');
                        showDebugInfo('è§£æç»“æœä¸ºç©º');
                        return;
                    }
                    
                    // ä¿å­˜åˆ—æ ‡é¢˜ï¼ˆç¬¬ä¸€è¡Œï¼‰
                    columnHeaders = jsonData[0] || [];
                    
                    showDebugInfo(`æˆåŠŸè§£æ ${jsonData.length} è¡Œæ•°æ®ï¼Œæ¯è¡Œ ${jsonData[0] ? jsonData[0].length : 0} åˆ—`);
                    
                    // åŠ è½½æ•°æ®åˆ°è¡¨æ ¼
                    hot.loadData(jsonData);
                    currentData = jsonData;
                    currentFileName = file.name.replace(/\.[^/.]+$/, "");
                    
                    // è®¾ç½®åˆ—æ ‡é¢˜
                    if (columnHeaders.length > 0) {
                        hot.updateSettings({
                            colHeaders: columnHeaders
                        });
                    }
                    
                    // è‡ªåŠ¨è°ƒæ•´åˆ—å®½
                    setTimeout(() => {
                        autoFitColumns();
                    }, 300);
                    
                    showStatus(`âœ… æ–‡ä»¶"${file.name}"åŠ è½½æˆåŠŸï¼å…± ${jsonData.length - 1} è¡Œæ•°æ®ï¼Œ${columnHeaders.length} åˆ—ã€‚`, 'success');
                    
                } catch (error) {
                    console.error('è§£æé”™è¯¯:', error);
                    showStatus('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼: ' + error.message, 'error');
                    showDebugInfo('é”™è¯¯: ' + error.message);
                }
            };

            reader.onerror = function() {
                showStatus('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                showDebugInfo('æ–‡ä»¶è¯»å–é”™è¯¯');
            };

            reader.readAsArrayBuffer(file);
        }

        // 2. ä»è¡¨æ ¼ä¸‹è½½Excelæ–‡ä»¶
        function saveFile() {
            if (!hot || hot.countRows() === 0) {
                showStatus('è¡¨æ ¼ä¸­æ²¡æœ‰æ•°æ®ï¼Œæ— æ³•ä¸‹è½½', 'error');
                showDebugInfo('æ— æ•°æ®å¯ä¿å­˜');
                return;
            }

            try {
                const data = hot.getData();
                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Sheet1");

                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-');
                const fileName = currentFileName 
                    ? `${currentFileName}_å·²å¤„ç†_${timestamp}.xlsx`
                    : `å¤„ç†åçš„è¡¨æ ¼_${timestamp}.xlsx`;

                XLSX.writeFile(wb, fileName);
                showStatus(`âœ… æ–‡ä»¶"${fileName}"å·²å¼€å§‹ä¸‹è½½`, 'success');
                showDebugInfo(`å·²ç”Ÿæˆæ–‡ä»¶: ${fileName}`);
            } catch (error) {
                console.error('ä¿å­˜é”™è¯¯:', error);
                showStatus('æ–‡ä»¶ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                showDebugInfo('ä¿å­˜é”™è¯¯: ' + error.message);
            }
        }

        // 3. æ¸…ç©ºè¡¨æ ¼
        function clearData() {
            if (hot.countRows() === 0) {
                showStatus('è¡¨æ ¼å·²ç»æ˜¯ç©ºçš„äº†', 'info');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰æ‰€æœ‰è¡¨æ ¼æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                hot.loadData([[]]);
                currentData = [];
                currentFileName = '';
                columnHeaders = [];
                document.getElementById('fileInput').value = '';
                showStatus('è¡¨æ ¼å·²æ¸…ç©º', 'success');
                showDebugInfo('è¡¨æ ¼å·²æ¸…ç©º');
            }
        }

        // 4. å››ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬å‡½æ•°ï¼ˆåŸºç¡€æ¡†æ¶ï¼‰
        function checkAge() {
            if (!hot || hot.countRows() === 0) {
                showStatus('è¯·å…ˆåŠ è½½æ•°æ®', 'error');
                return;
            }
            showStatus('æ£€éªŒæ˜¯å¦æ»¡14å‘¨å²åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            showDebugInfo('å¹´é¾„æ£€éªŒåŠŸèƒ½å¾…å®ç°');
        }

        function markLeague() {
            if (!hot || hot.countRows() === 0) {
                showStatus('è¯·å…ˆåŠ è½½æ•°æ®', 'error');
                return;
            }
            showStatus('è‡ªåŠ¨æ ‡è®°æ˜¯å¦å…¥å›¢åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            showDebugInfo('å…¥å›¢æ ‡è®°åŠŸèƒ½å¾…å®ç°');
        }

        function markGraduation() {
            if (!hot || hot.countRows() === 0) {
                showStatus('è¯·å…ˆåŠ è½½æ•°æ®', 'error');
                return;
            }
            showStatus('è‡ªåŠ¨æ ‡è®°æ˜¯å¦æ¯•ä¸šåŠŸèƒ½å¼€å‘ä¸­...', 'info');
            showDebugInfo('æ¯•ä¸šæ ‡è®°åŠŸèƒ½å¾…å®ç°');
        }

        function checkActivity() {
            if (!hot || hot.countRows() === 0) {
                showStatus('è¯·å…ˆåŠ è½½æ•°æ®', 'error');
                return;
            }
            showStatus('æ£€éªŒå…‰å±±å¿è·¨æ ¡ç§¯æåˆ†å­åŠŸèƒ½å¼€å‘ä¸­...', 'info');
            showDebugInfo('è·¨æ ¡æ£€æŸ¥åŠŸèƒ½å¾…å®ç°');
        }

        // 5. æäº¤åŠŸèƒ½ï¼ˆè‡ªåŠ¨è·³è½¬ï¼‰
        function submitToCollectForm() {
            if (!hot || hot.countRows() === 0) {
                showStatus('è¡¨æ ¼ä¸­æ²¡æœ‰æ•°æ®ï¼Œæ— æ³•æäº¤', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æäº¤å—ï¼Ÿ\n\nç‚¹å‡»"ç¡®å®š"å°†ï¼š\n1. è‡ªåŠ¨ä¿å­˜å½“å‰è¡¨æ ¼ä¸ºExcelæ–‡ä»¶\n2. è·³è½¬åˆ°æ–‡ä»¶æ”¶é›†é¡µé¢')) {
                try {
                    // å…ˆä¿å­˜æ–‡ä»¶
                    saveFile();
                    
                    // è·³è½¬åˆ°æ”¶é›†è¡¨ï¼ˆè¯·æ›¿æ¢ä¸ºä½ çš„å®é™…é“¾æ¥ï¼‰
                    const collectFormUrl = 'https://f.wps.cn/g/JaaWyioV/'; // â† é‡è¦ï¼šè¿™é‡Œè¦æ¢æˆä½ çš„é‡‘å±±æ–‡æ¡£æ”¶é›†è¡¨é“¾æ¥
                    
                    setTimeout(() => {
                        window.open(collectFormUrl, '_blank');
                        showStatus('å·²è·³è½¬åˆ°æ”¶é›†è¡¨é¡µé¢ï¼è¯·åœ¨æ‰“å¼€çš„é¡µé¢ä¸­ä¸Šä¼ åˆšåˆšä¸‹è½½çš„æ–‡ä»¶ã€‚', 'success');
                        showDebugInfo('å·²è·³è½¬åˆ°æ”¶é›†è¡¨');
                    }, 1000);
                    
                } catch (error) {
                    showStatus('æäº¤è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œè¯·é‡è¯•', 'error');
                    showDebugInfo('æäº¤é”™è¯¯: ' + error.message);
                }
            }
        }

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            // Ctrl+S ä¿å­˜æ–‡ä»¶
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveFile();
            }
            // Ctrl+O é€‰æ‹©æ–‡ä»¶
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                document.getElementById('fileInput').click();
            }
        });
    </script>
</body>
</html>
